#!/bin/bash

# Regular updates
sudo pacman -Syu;
 
# AUR updates (intentionally decoupled from pacman)
yay -Syu;
 
# NPM updates
npm -g update;

# GO packages
go get -u all

# Ruby packages
gem update
 
# VIM plugins updates
/usr/bin/vim +PlugUpgrade +PlugUpdate +qa
 
# TMUX plugins updates
~/.tmux/plugins/tpm/bin/update_plugins all

## Remote servers update
ansible-playbook $PLAYBOOKS_HOME/ovh/activate_forwarding.yml
ansible-playbook $PLAYBOOKS_HOME/upgrade_all.yml
ansible-playbook $PLAYBOOKS_HOME/ovh/deactivate_forwarding.yml

# SDK manager update
if [ -x "$(command -v sdkmanager)" ];
then
  sdkmanager --update
fi

# PIP update
if [ -x "$(command -v pip)" ];
then
  pip list --outdated --format=freeze | grep -v '^\-e' | cut -d = -f 1  | xargs -n1 pip install --use-feature=2020-resolver -U
  ## Temporary : necessary to keep this one downgraded because of gsdrive
  pip install --upgrade oauth2client==3
fi

## a0 upgrade
if [ "$(ls -A /mnt/a0/boot)" ]; then
  sudo arch-chroot /mnt/a0 pacman -Syu --noconfirm
else
  echo "a0 not present, skipping";
fi

